package com.pmone.demo;

import com.pmone.demo.calculate.BoundingBox;
import com.pmone.demo.model.Result;
import com.pmone.demo.rest.model.Bill;
import com.pmone.demo.rest.utils.ParseReal;
import org.codehaus.jackson.map.ObjectMapper;
import org.junit.Assert;
import org.junit.jupiter.api.Test;

import java.io.IOException;
import java.util.List;
import java.util.stream.Collectors;

public class ParseLidlTest {

  String content = "{\"status\":\"Succeeded\",\"recognitionResult\":{\"lines\":[{\"boundingBox\":[107,23,274,22,272,96,107,94],\"text\":\"real\",\"words\":[{\"boundingBox\":[106,21,284,21,283,95,106,95],\"text\":\"real\"}]},{\"boundingBox\":[375,26,454,24,455,39,376,41],\"text\":\"real GmbH\",\"words\":[{\"boundingBox\":[376,27,407,26,408,40,376,41],\"text\":\"real\"},{\"boundingBox\":[410,26,450,25,450,40,411,40],\"text\":\"GmbH\"}]},{\"boundingBox\":[327,45,505,43,506,59,327,60],\"text\":\"10365 Berlin-Lichtenberg\",\"words\":[{\"boundingBox\":[326,45,367,45,367,60,326,60],\"text\":\"10365\"},{\"boundingBox\":[371,45,504,44,503,59,371,60],\"text\":\"Berlin-Lichtenberg\"}]},{\"boundingBox\":[324,63,502,59,503,75,325,78],\"text\":\"Frankfurter Allee 113-117\",\"words\":[{\"boundingBox\":[323,63,406,62,406,77,323,78],\"text\":\"Frankfurter\"},{\"boundingBox\":[407,62,443,62,443,76,407,77],\"text\":\"Allee\"},{\"boundingBox\":[446,61,503,60,503,76,446,76],\"text\":\"113-117\"}]},{\"boundingBox\":[333,79,486,77,487,92,334,94],\"text\":\"Tel.: 0 30 / 5 57 70 00\",\"words\":[{\"boundingBox\":[338,79,371,79,371,94,338,94],\"text\":\"Tel.:\"},{\"boundingBox\":[371,79,381,79,381,93,371,94],\"text\":\"0\"},{\"boundingBox\":[385,79,402,79,402,93,385,93],\"text\":\"30\"},{\"boundingBox\":[402,79,412,79,412,93,402,93],\"text\":\"/\"},{\"boundingBox\":[412,79,422,79,423,93,412,93],\"text\":\"5\"},{\"boundingBox\":[425,79,442,79,442,93,425,93],\"text\":\"57\"},{\"boundingBox\":[446,79,463,78,463,93,446,93],\"text\":\"70\"},{\"boundingBox\":[466,78,484,78,485,92,466,93],\"text\":\"00\"}]},{\"boundingBox\":[118,164,201,161,202,181,118,184],\"text\":\"2 x 0,99\",\"words\":[{\"boundingBox\":[118,164,131,164,132,184,119,184],\"text\":\"2\"},{\"boundingBox\":[137,164,150,164,151,183,138,184],\"text\":\"x\"},{\"boundingBox\":[158,164,201,163,200,182,158,183],\"text\":\"0,99\",\"confidence\":\"Low\"}]},{\"boundingBox\":[200,143,384,146,383,165,199,162],\"text\":\"TIP BUTTERTOAST 50\",\"words\":[{\"boundingBox\":[199,144,230,144,230,162,199,162],\"text\":\"TIP\"},{\"boundingBox\":[240,145,353,146,352,164,240,163],\"text\":\"BUTTERTOAST\"},{\"boundingBox\":[360,146,382,146,381,165,359,164],\"text\":\"50\"}]},{\"boundingBox\":[439,147,502,146,503,165,440,166],\"text\":\"0,69 E\",\"words\":[{\"boundingBox\":[440,148,481,147,481,166,440,166],\"text\":\"0,69\",\"confidence\":\"Low\"},{\"boundingBox\":[489,147,500,148,500,166,488,166],\"text\":\"E\"}]},{\"boundingBox\":[197,182,384,184,383,204,196,202],\"text\":\"TIP FRISCHKAESE 30\",\"words\":[{\"boundingBox\":[198,183,229,184,230,203,199,203],\"text\":\"TIP\"},{\"boundingBox\":[237,184,352,185,352,203,238,203],\"text\":\"FRISCHKAESE\"},{\"boundingBox\":[361,185,383,185,383,204,361,203],\"text\":\"30\"}]},{\"boundingBox\":[197,203,383,202,384,222,198,223],\"text\":\"rQ BACKPAPIERZUSCH\",\"words\":[{\"boundingBox\":[197,205,219,204,220,223,197,223],\"text\":\"rQ\"},{\"boundingBox\":[229,204,382,205,382,223,229,223],\"text\":\"BACKPAPIERZUSCH\"}]},{\"boundingBox\":[437,186,503,185,504,205,438,206],\"text\":\"1, 98 E\",\"words\":[{\"boundingBox\":[440,187,463,186,464,206,440,206],\"text\":\"1,\",\"confidence\":\"Low\"},{\"boundingBox\":[459,186,482,186,483,206,460,206],\"text\":\"98\"},{\"boundingBox\":[489,186,502,186,502,206,489,206],\"text\":\"E\"}]},{\"boundingBox\":[116,225,201,224,202,245,117,245],\"text\":\"5 x 0,99\",\"words\":[{\"boundingBox\":[117,225,130,226,130,245,117,246],\"text\":\"5\"},{\"boundingBox\":[137,226,150,226,150,245,137,245],\"text\":\"x\"},{\"boundingBox\":[158,226,200,225,201,245,158,245],\"text\":\"0,99\",\"confidence\":\"Low\"}]},{\"boundingBox\":[440,206,503,204,504,224,441,226],\"text\":\"2, 19 V\",\"words\":[{\"boundingBox\":[440,207,463,207,464,226,440,226],\"text\":\"2,\",\"confidence\":\"Low\"},{\"boundingBox\":[461,207,482,206,482,225,461,226],\"text\":\"19\"},{\"boundingBox\":[490,206,503,205,503,225,491,225],\"text\":\"V\"}]},{\"boundingBox\":[197,244,375,245,374,265,196,264],\"text\":\"HEIDELBEEREN 1259\",\"words\":[{\"boundingBox\":[197,246,320,245,320,265,197,265],\"text\":\"HEIDELBEEREN\"},{\"boundingBox\":[330,245,373,246,373,265,330,265],\"text\":\"1259\",\"confidence\":\"Low\"}]},{\"boundingBox\":[198,265,386,266,385,284,197,283],\"text\":\"EINWEGSPRITZBEUTEL\",\"words\":[{\"boundingBox\":[197,266,382,266,382,284,198,285],\"text\":\"EINWEGSPRITZBEUTEL\"}]},{\"boundingBox\":[440,248,505,248,505,266,441,267],\"text\":\"4, 95 E\",\"words\":[{\"boundingBox\":[441,249,462,249,462,267,442,267],\"text\":\"4,\"},{\"boundingBox\":[461,249,482,248,482,267,461,267],\"text\":\"95\"},{\"boundingBox\":[490,248,502,248,502,267,490,267],\"text\":\"E\"}]},{\"boundingBox\":[199,286,364,285,365,303,200,304],\"text\":\"TIP BIERSCHINKEN\",\"words\":[{\"boundingBox\":[200,286,230,286,231,304,200,304],\"text\":\"TIP\"},{\"boundingBox\":[239,286,361,286,361,303,239,304],\"text\":\"BIERSCHINKEN\"}]},{\"boundingBox\":[441,268,505,267,506,286,442,288],\"text\":\"1, 99 V\",\"words\":[{\"boundingBox\":[441,269,464,268,463,287,441,288],\"text\":\"1,\",\"confidence\":\"Low\"},{\"boundingBox\":[461,268,484,268,484,287,461,287],\"text\":\"99\"},{\"boundingBox\":[490,268,503,268,502,287,490,287],\"text\":\"V\"}]},{\"boundingBox\":[118,305,274,306,273,325,117,324],\"text\":\"0, 600 KG x 4, 99\",\"words\":[{\"boundingBox\":[117,306,141,306,141,325,117,324],\"text\":\"0,\"},{\"boundingBox\":[137,306,170,306,171,325,138,324],\"text\":\"600\"},{\"boundingBox\":[177,306,201,306,202,325,177,325],\"text\":\"KG\"},{\"boundingBox\":[208,306,221,306,221,325,209,325],\"text\":\"x\"},{\"boundingBox\":[229,306,252,306,253,325,230,325],\"text\":\"4,\"},{\"boundingBox\":[250,306,272,306,273,326,251,325],\"text\":\"99\"}]},{\"boundingBox\":[441,287,504,286,505,305,442,306],\"text\":\"1,25 E\",\"words\":[{\"boundingBox\":[441,287,484,287,483,306,440,307],\"text\":\"1,25\",\"confidence\":\"Low\"},{\"boundingBox\":[490,287,503,287,502,306,490,306],\"text\":\"E\"}]},{\"boundingBox\":[199,326,384,325,385,345,200,346],\"text\":\"SW BAUCH I . SCH. M . K\",\"words\":[{\"boundingBox\":[200,327,220,327,220,346,201,346],\"text\":\"SW\"},{\"boundingBox\":[229,327,281,326,281,346,230,346],\"text\":\"BAUCH\"},{\"boundingBox\":[290,326,303,326,303,346,291,346],\"text\":\"I\"},{\"boundingBox\":[300,326,314,326,314,346,301,346],\"text\":\".\"},{\"boundingBox\":[311,326,354,326,354,345,312,346],\"text\":\"SCH.\",\"confidence\":\"Low\"},{\"boundingBox\":[349,326,361,326,362,345,349,345],\"text\":\"M\"},{\"boundingBox\":[361,326,375,326,375,345,362,345],\"text\":\".\"},{\"boundingBox\":[370,326,382,326,382,345,370,345],\"text\":\"K\"}]},{\"boundingBox\":[200,347,304,347,304,366,200,366],\"text\":\"TIP ZUCKER\",\"words\":[{\"boundingBox\":[199,347,231,347,231,366,199,366],\"text\":\"TIP\"},{\"boundingBox\":[240,347,301,347,301,366,240,366],\"text\":\"ZUCKER\"}]},{\"boundingBox\":[442,328,506,328,506,348,442,348],\"text\":\"2,99 E\",\"words\":[{\"boundingBox\":[442,328,484,328,484,348,442,347],\"text\":\"2,99\",\"confidence\":\"Low\"},{\"boundingBox\":[491,328,503,328,503,348,491,348],\"text\":\"E\"}]},{\"boundingBox\":[442,347,508,349,507,367,441,366],\"text\":\"0,59 E\",\"words\":[{\"boundingBox\":[443,348,485,349,484,367,442,366],\"text\":\"0,59\"},{\"boundingBox\":[492,349,504,350,503,367,491,367],\"text\":\"E\"}]},{\"boundingBox\":[199,366,313,367,312,387,198,385],\"text\":\"SCHALE 2009\",\"words\":[{\"boundingBox\":[199,367,260,367,260,386,200,387],\"text\":\"SCHALE\"},{\"boundingBox\":[270,367,312,369,312,387,270,386],\"text\":\"2009\",\"confidence\":\"Low\"}]},{\"boundingBox\":[199,387,354,386,355,406,199,406],\"text\":\"BUTTER FRISCH 8\",\"words\":[{\"boundingBox\":[199,387,261,388,261,407,200,407],\"text\":\"BUTTER\"},{\"boundingBox\":[268,388,332,387,333,407,269,407],\"text\":\"FRISCH\"},{\"boundingBox\":[341,387,354,387,354,407,341,407],\"text\":\"8\"}]},{\"boundingBox\":[445,367,510,370,509,390,444,386],\"text\":\"0,99 E\",\"words\":[{\"boundingBox\":[444,368,485,369,486,388,444,387],\"text\":\"0,99\",\"confidence\":\"Low\"},{\"boundingBox\":[492,370,505,371,505,389,493,389],\"text\":\"E\"}]},{\"boundingBox\":[198,407,386,408,385,428,197,427],\"text\":\"KATHI WEIZENMEHL T\",\"words\":[{\"boundingBox\":[197,408,252,409,252,427,197,428],\"text\":\"KATHI\"},{\"boundingBox\":[258,409,362,408,362,428,258,427],\"text\":\"WEIZENMEHL\"},{\"boundingBox\":[372,408,385,408,384,429,372,428],\"text\":\"T\"}]},{\"boundingBox\":[445,388,510,387,511,407,446,408],\"text\":\"2,29 E\",\"words\":[{\"boundingBox\":[443,388,487,388,487,408,444,408],\"text\":\"2,29\",\"confidence\":\"Low\"},{\"boundingBox\":[493,388,506,388,506,408,493,408],\"text\":\"E\"}]},{\"boundingBox\":[444,409,511,408,512,427,445,429],\"text\":\"1,59 E\",\"words\":[{\"boundingBox\":[444,410,487,409,487,429,444,430],\"text\":\"1,59\",\"confidence\":\"Low\"},{\"boundingBox\":[494,409,507,409,507,429,494,429],\"text\":\"E\"}]},{\"boundingBox\":[197,429,385,430,384,449,196,448],\"text\":\"LEHA VEGANE SCHLAG\",\"words\":[{\"boundingBox\":[197,430,240,430,240,448,197,449],\"text\":\"LEHA\"},{\"boundingBox\":[248,430,310,430,310,448,249,448],\"text\":\"VEGANE\"},{\"boundingBox\":[321,430,385,430,385,450,321,449],\"text\":\"SCHLAG\"}]},{\"boundingBox\":[193,450,384,449,385,470,194,471],\"text\":\"rBIO HEIDELBEER 25\",\"words\":[{\"boundingBox\":[196,451,241,451,242,471,196,471],\"text\":\"rBIO\"},{\"boundingBox\":[247,451,353,451,352,471,247,471],\"text\":\"HEIDELBEER\"},{\"boundingBox\":[362,451,384,451,384,471,361,471],\"text\":\"25\"}]},{\"boundingBox\":[440,431,512,430,513,450,441,451],\"text\":\"0, 95 E\",\"words\":[{\"boundingBox\":[444,431,468,431,468,450,444,451],\"text\":\"0,\"},{\"boundingBox\":[465,431,487,431,487,450,466,451],\"text\":\"95\"},{\"boundingBox\":[494,431,507,431,507,450,495,450],\"text\":\"E\"}]},{\"boundingBox\":[199,471,385,472,384,492,198,491],\"text\":\"DEKOR KREATION 609\",\"words\":[{\"boundingBox\":[198,472,249,472,249,491,198,491],\"text\":\"DEKOR\"},{\"boundingBox\":[258,472,342,472,341,492,257,491],\"text\":\"KREATION\"},{\"boundingBox\":[352,472,384,473,383,492,351,492],\"text\":\"609\",\"confidence\":\"Low\"}]},{\"boundingBox\":[441,451,513,451,513,472,441,472],\"text\":\"2,29 E\",\"words\":[{\"boundingBox\":[444,452,488,451,488,472,444,473],\"text\":\"2,29\",\"confidence\":\"Low\"},{\"boundingBox\":[494,451,507,451,507,472,493,472],\"text\":\"E\"}]},{\"boundingBox\":[444,472,513,473,512,491,443,490],\"text\":\"1, 79 E\",\"words\":[{\"boundingBox\":[444,473,466,473,466,492,445,492],\"text\":\"1,\"},{\"boundingBox\":[466,473,487,473,487,492,466,492],\"text\":\"79\"},{\"boundingBox\":[494,473,507,474,506,491,494,491],\"text\":\"E\"}]},{\"boundingBox\":[196,492,314,493,313,512,195,511],\"text\":\"MILKA TAFEL\",\"words\":[{\"boundingBox\":[195,493,250,493,250,512,195,512],\"text\":\"MILKA\"},{\"boundingBox\":[259,493,311,493,310,512,259,512],\"text\":\"TAFEL\"}]},{\"boundingBox\":[444,492,513,493,512,512,443,511],\"text\":\"0, 65 E\",\"words\":[{\"boundingBox\":[444,493,468,493,468,512,445,512],\"text\":\"0,\"},{\"boundingBox\":[464,493,486,493,486,512,464,512],\"text\":\"65\"},{\"boundingBox\":[494,493,506,493,506,512,494,512],\"text\":\"E\"}]},{\"boundingBox\":[196,513,293,513,292,533,195,532],\"text\":\"AROMA 4ER\",\"words\":[{\"boundingBox\":[196,513,250,514,250,533,196,533],\"text\":\"AROMA\"},{\"boundingBox\":[259,514,291,514,290,533,259,533],\"text\":\"4ER\"}]},{\"boundingBox\":[443,513,511,513,511,531,444,532],\"text\":\"0,69 E\",\"words\":[{\"boundingBox\":[444,514,486,514,487,532,445,532],\"text\":\"0,69\"},{\"boundingBox\":[494,514,506,513,506,532,494,532],\"text\":\"E\"}]},{\"boundingBox\":[196,535,325,536,324,556,195,555],\"text\":\"rQ MINZE 15g\",\"words\":[{\"boundingBox\":[193,537,218,536,219,556,194,556],\"text\":\"rQ\"},{\"boundingBox\":[225,536,280,536,280,556,225,556],\"text\":\"MINZE\"},{\"boundingBox\":[290,536,323,537,323,556,290,556],\"text\":\"15g\"}]},{\"boundingBox\":[440,535,510,533,511,552,441,554],\"text\":\"0, 99 E\",\"words\":[{\"boundingBox\":[444,535,468,535,468,554,444,554],\"text\":\"0,\"},{\"boundingBox\":[464,535,487,534,487,553,464,554],\"text\":\"99\"},{\"boundingBox\":[493,534,506,534,506,553,493,553],\"text\":\"E\"}]},{\"boundingBox\":[195,556,387,555,388,577,196,578],\"text\":\"rQ EIER KL. M-L GK\",\"words\":[{\"boundingBox\":[193,558,218,558,218,577,193,577],\"text\":\"rQ\"},{\"boundingBox\":[225,557,269,557,269,578,225,577],\"text\":\"EIER\"},{\"boundingBox\":[277,557,313,557,313,578,277,578],\"text\":\"KL.\",\"confidence\":\"Low\"},{\"boundingBox\":[319,557,353,556,352,577,319,578],\"text\":\"M-L\"},{\"boundingBox\":[363,556,384,556,383,576,362,577],\"text\":\"GK\"}]},{\"boundingBox\":[445,556,509,553,510,571,445,574],\"text\":\"1,99 E\",\"words\":[{\"boundingBox\":[444,556,487,555,487,573,444,574],\"text\":\"1,99\",\"confidence\":\"Low\"},{\"boundingBox\":[493,555,505,554,505,572,493,573],\"text\":\"E\"}]},{\"boundingBox\":[197,577,318,578,317,597,196,596],\"text\":\"PUDERZUCKER\",\"words\":[{\"boundingBox\":[195,578,311,578,311,597,195,597],\"text\":\"PUDERZUCKER\"}]},{\"boundingBox\":[441,575,510,573,511,593,442,594],\"text\":\"0, 35 E\",\"words\":[{\"boundingBox\":[443,575,467,575,467,594,443,594],\"text\":\"0,\"},{\"boundingBox\":[465,575,486,575,485,594,464,594],\"text\":\"35\"},{\"boundingBox\":[493,575,506,575,505,593,493,593],\"text\":\"E\"}]},{\"boundingBox\":[194,599,377,596,378,616,195,618],\"text\":\"WACHSKERZENZAHLEN\",\"words\":[{\"boundingBox\":[194,599,374,597,373,617,194,618],\"text\":\"WACHSKERZENZAHLEN\"}]},{\"boundingBox\":[444,595,509,593,510,613,445,614],\"text\":\"0,99 V\",\"words\":[{\"boundingBox\":[444,597,486,595,486,614,445,615],\"text\":\"0,99\",\"confidence\":\"Low\"},{\"boundingBox\":[494,595,506,594,506,613,494,613],\"text\":\"V\"}]},{\"boundingBox\":[195,619,386,617,386,636,196,639],\"text\":\"BACK-UND SPEISEFAR\",\"words\":[{\"boundingBox\":[195,620,281,619,282,638,195,639],\"text\":\"BACK-UND\"},{\"boundingBox\":[290,619,384,617,384,637,290,638],\"text\":\"SPEISEFAR\"}]},{\"boundingBox\":[441,615,508,613,509,634,442,636],\"text\":\"2, 99 E\",\"words\":[{\"boundingBox\":[444,615,468,616,468,636,444,636],\"text\":\"2,\"},{\"boundingBox\":[464,616,487,616,487,635,464,636],\"text\":\"99\"},{\"boundingBox\":[493,615,506,615,506,635,493,635],\"text\":\"E\"}]},{\"boundingBox\":[195,641,380,638,381,658,196,660],\"text\":\"WACHSKERZENZAHLEN\",\"words\":[{\"boundingBox\":[194,641,372,639,372,658,194,661],\"text\":\"WACHSKERZENZAHLEN\"}]},{\"boundingBox\":[443,638,508,637,509,657,444,658],\"text\":\"0,99 V\",\"words\":[{\"boundingBox\":[444,638,488,638,488,658,444,658],\"text\":\"0,99\"},{\"boundingBox\":[494,638,507,638,508,658,494,658],\"text\":\"V\"}]},{\"boundingBox\":[197,662,251,662,251,681,197,681],\"text\":\"SUMME\",\"words\":[{\"boundingBox\":[197,662,248,662,248,681,197,681],\"text\":\"SUMME\"}]},{\"boundingBox\":[352,660,385,660,385,678,352,678],\"text\":\"EUR\",\"words\":[{\"boundingBox\":[352,660,384,660,384,678,352,678],\"text\":\"EUR\"}]},{\"boundingBox\":[435,659,489,660,488,679,435,679],\"text\":\"36,17\",\"words\":[{\"boundingBox\":[434,658,489,658,489,678,434,678],\"text\":\"36,17\"}]},{\"boundingBox\":[195,704,281,702,282,722,196,724],\"text\":\"EC-Karte\",\"words\":[{\"boundingBox\":[195,704,280,703,280,723,195,724],\"text\":\"EC-Karte\"}]},{\"boundingBox\":[353,702,386,703,385,722,352,721],\"text\":\"EUR\",\"words\":[{\"boundingBox\":[350,701,383,702,382,721,349,720],\"text\":\"EUR\"}]},{\"boundingBox\":[435,703,491,704,490,724,435,722],\"text\":\"36,17\",\"words\":[{\"boundingBox\":[434,701,490,703,490,723,434,721],\"text\":\"36,17\",\"confidence\":\"Low\"}]}]}}";

  @Test
  public void test() throws IOException {
    ObjectMapper mapper = new ObjectMapper();
    Result result;
    result = mapper.readValue(content, Result.class);
    List<BoundingBox> boundingBoxes = result.getRecognitionResult().getLines().stream().map(line -> new BoundingBox(line.getBoundingBox(), line.getText())).collect(Collectors.toList());
    Bill bill = ParseReal.parseLines(boundingBoxes);
  }

  @Test
  public void test1() {
    String a = "42,5";
    String b = "4 2 , 5";
    String c = "42, 5 ";

    Double r = 42.5;

    Assert.assertEquals(par(a), r);
    Assert.assertEquals(par(b), r);
    Assert.assertEquals(par(c), r);
  }

  private Double par(String a) {
    String[] split = a.split(",");
    Double d = Double.valueOf(split[0].replaceAll(" ", ""));

    Double e = Double.valueOf("0." + split[1].replaceAll(" ", ""));

    return d + e;
  }
}
